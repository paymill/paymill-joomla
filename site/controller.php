<?php// Version 1.00// Author: Paymill GmbH - M. Kimmel, 2013// no direct accessdefined('_JEXEC') or die('Restricted access');jimport('joomla.application.component.controller');class PaymillController extends JController{    //standard function to display view    function display()    {        parent::display();    }    function payCC()    {        $db =& JFactory::getDBO();        $q = 'SELECT * FROM #__paymill_settings WHERE id = 1';        $db->setQuery( $q );        $settings = $db->loadAssoc();        if($settings["mode"] == 0) {            $mode = 'private_test';        }        elseif($settings["mode"] == 1) {            $mode = 'private_live';        }        else {            $mode = 'private_test';        }        $api_key = $settings[$mode];        $api_host = 'https://api.paymill.com/v2/';        set_include_path(implode(PATH_SEPARATOR, array( realpath(realpath(dirname(__FILE__)) . '/lib'), get_include_path(), )));        $token = $_POST['paymillToken'];        if ($token) {            require "components/com_paymill/lib/Services/Paymill/Transactions.php";            $transactionsObject = new Services_Paymill_Transactions($api_key, $api_host);            $params = array(                'amount' => ($_POST['amount'] * 100),                'currency' => 'EUR',                'token' => $token,                'description' => $_POST['description']            );            $transaction = $transactionsObject->create($params);            $order_id = $transaction['description'];            $status = $transaction['status'];            $card_token = $transaction['creditcard']['id'];            if($status == 'closed') {                $q = "INSERT INTO #__paymill (name, description, status, token) VALUES ('" . $_POST['name'] . "', '" . $_POST['description'] . "', 'payed', '" . $token . "')";                $db->setQuery( $q );                $db->query();            }            return var_dump($transaction, true);        }    }}?>